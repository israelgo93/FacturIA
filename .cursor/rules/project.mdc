---
description: "Reglas globales del proyecto facturIA SaaS"
globs: ["**/*"]
---

# facturIA — Reglas del Proyecto

## Stack Tecnológico
- Framework: Next.js 16+ con App Router
- Lenguaje: JavaScript (ES2024) — NO TypeScript
- UI: React 19 + Tailwind CSS 4
- Backend: Supabase (PostgreSQL 15 + Auth + Storage)
- Estado: Zustand 5
- Validación: Zod 4 + React Hook Form 7
- IA: Google Gemini 3 Flash (`gemini-3-flash-preview`) via @google/genai + Vercel AI SDK (@ai-sdk/google)
- Temas: next-themes (light/dark/system)
- XML/Firma: fast-xml-parser + node-forge + xml-crypto
- SOAP SRI: soap (cliente SOAP para WS del SRI)
- PDF: @react-pdf/renderer + pdf-lib
- Email: resend
- Despliegue: Google Cloud Run (Docker)

## Convenciones de Código
- Usar `'use server'` para Server Actions
- Usar `'use client'` solo cuando sea necesario
- Preferir Server Components por defecto
- Nombres de archivos: kebab-case para rutas, PascalCase para componentes
- Funciones: camelCase
- Constantes: UPPER_SNAKE_CASE
- Comentarios en español para lógica de negocio

## Arquitectura
- Multi-tenant: SIEMPRE filtrar por empresa_id
- RLS obligatorio en TODAS las tablas
- Validación dual: Zod (frontend) + Server Actions (backend)
- Nunca exponer service_role_key al cliente

## Diseño UI — Sistema de Temas
- Soporte de temas: claro, oscuro y sistema (next-themes)
- Variables CSS definidas en globals.css para ambos modos
- Componentes Glass adaptados con variables CSS (NO valores hardcoded)
- Modo oscuro: fondo #09090b, glass blanco con baja opacidad
- Modo claro: fondo #fafafa, glass negro con baja opacidad, bordes grises sutiles
- Iconos: lucide-react exclusivamente
- Notificaciones: sonner (toast)
- Transiciones: 300ms, easing suave

## SRI Ecuador
- Ambiente 1 = Pruebas, Ambiente 2 = Producción
- Clave de acceso: 49 dígitos con Módulo 11
- Firma: XAdES-BES con RSA-SHA1
- XML: UTF-8, sin espacios entre caracteres en campos alfanuméricos
- Secuenciales: 9 dígitos, rellenar con ceros a la izquierda
